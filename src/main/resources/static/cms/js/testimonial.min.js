var Testimonial=function(){return{initialize:function(){var a=this;Login.auth(function(){$(".contentpanel").load("/admin/testimoni-content-panel",function(){$(".sub-menu-testimonial").addClass("active");$(".pageheader-h2-icon").attr("class","pageheader-h2-icon");$(".pageheader-h2-icon").addClass("fa fa-envelope-o");$(".pageheader-h2-text").html(" Testimonial");$(".pageheader-module").html("Testimonial");$("#age").spinner({min:1,max:150});$("#content").wysihtml5({stylesheets:[]});$("#formvalidate").validate({submitHandler:function(b){a.saveOrUpdate(b)}});$("#btn-cancel").on("click",function(b){b.preventDefault();$("#testimonialModalForm").modal("hide")});a.loadTestimonial()})})},loadTestimonial:function(){if($("#datatable1").length){var a=this;$("#datatable1").dataTable().fnDestroy();$("#datatable1").show();$("#datatable1").dataTable({sAjaxSource:"/api/testimonials",sAjaxDataProp:"_embedded.testimonials",aoColumns:[{mData:null},{mData:null,mRender:function(d,c,e){var b='<div align="center"><img src="/public/images?path='+e.avatarPath+'" style="width:90px;height:90px;padding:3px;border:thin solid #dddddd;border-radius:5px;"></div>';return b}},{mData:null,mRender:function(d,c,e){var b=e.name+" ("+e.occupation+")";return b}},{mData:"age"},{mData:"website"},{mData:"content"},{mData:null,mRender:function(d,b,e){var g=e._links.self.href.split("/");var f=g[g.length-1];var c='<a onclick="Testimonial.detailTestimonial('+f+')">Edit</a>';c+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Testimonial.deleteTestimonial('+f+');}">Delete</a>';return c},bSortable:false}],bServerSide:true,fnServerData:a.serverDataProcessor,fnRowCallback:function(g,e,d,c){var f=e.pageSize;var h=e.pageNum;var b=(h*f+(d+1));$("td:eq(0)",g).html(b);if(e.prime){$(g).css({"background-color":"#001122"})}return g}})}},serverDataProcessor:function(g,o,e){var m={};for(var f=0;f<o.length;f++){m[o[f].name]=o[f].value}var l=m.iDisplayLength;var b=m.iDisplayStart;var k=(b==0)?0:(b/l);var h=m.iSortCol_0;var j=m.sSortDir_0;var n=m["mDataProp_"+h]!=null?m["mDataProp_"+h]:"idTestimonial";var c=new Array();c.push({name:"size",value:l});c.push({name:"page",value:k});c.push({name:"sort",value:n+","+j});var a=g;if(m.sSearch!=""){a="/api/testimonials/search/all";c.push({name:"q",value:m.sSearch})}var d=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,data:c,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer "+d)},success:function(i){i.iTotalRecords=i.page.size;i.iTotalDisplayRecords=i.page.totalElements;$.map(i._embedded.testimonials,function(q,p){q.pageNum=k;q.pageSize=l});e(i)},error:function(i){if(i.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load testimonial")}}})},saveOrUpdate:function(e){var h=this;var f={};$(e).serializeArray().map(function(i){f[i.name]=i.value});var g=f.idTestimonial;var a=$("#avatar")[0],d=$("#imageBackground")[0];var c=new Array("image/jpg","image/jpeg","image/png");if(a.files.length&&$.inArray(a.files[0].type,c)===-1){$('label[for="avatar"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="avatar"]').css("display","block")}else{if(d.files.length&&$.inArray(d.files[0].type,c)===-1){$('label[for="avatar"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="avatar"]').css("display","block")}else{var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");this.readImage(d.files,function(i){if(typeof i!=="undefined"){f.imageBackgroundPath=i.replace(/^data:image\/[a-z]+;base64,/,"");f.imageBackgroundPathChanged=true}h.readImage(a.files,function(j){if(typeof j!=="undefined"){f.avatarPath=j.replace(/^data:image\/[a-z]+;base64,/,"");f.avatarPathChanged=true}f=JSON.stringify(f);$.ajax({dataType:"json",contentType:"application/json",type:"PUT",url:"/api/testimonialscustom/"+g,data:f,beforeSend:function(k){k.setRequestHeader("Authorization","Bearer "+b)},success:function(k){$("#testimonialModalForm").modal("hide");Notification.show("success","Testimonial saved successfully",function(){h.loadTestimonial();h.loadNotification()})},error:function(k){if(k.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to save testimonial")}}})})})}}},detailTestimonial:function(c){var a="/api/testimonials/"+c;var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(d){d.setRequestHeader("Authorization","Bearer "+b)},success:function(d){var f=d._links.self.href.split("/");var e=f[f.length-1];if($.isNumeric(e)){$("#idTestimonial").val(e)}$("#name").val(d.name);$("#age").val(d.age);$("#occupation").val(d.occupation);$("#website").val(d.website);$("#content").data("wysihtml5").editor.setValue(d.content);$("#content").autogrow();if(d.avatarPath!=null&&d.avatarPath!==""){$("#avatar-image").attr("src","/public/images?path="+d.avatarPath);$(".avatar-preview").css("display","block");$("#avatar-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview").html("")}else{$(".avatar-preview").css("display","none");$("#avatar-image").attr("src","")}if(d.imageBackgroundPath!=null&&d.imageBackgroundPath!==""){$("#background-image").attr("src","/public/images?path="+d.imageBackgroundPath);$("#background-image").css("display","block");$("#background-image-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview background-image-preview").html("")}else{$("#background-image").css("display","none");$("#background-image").attr("src","")}$("#prime").attr("checked",d.prime);$("#approval").attr("checked",d.approval);$("#testimonialModalForm").modal("show")},error:function(d){if(d.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load testimonial")}}})},deleteTestimonial:function(d){var c=this;var a="/api/testimonialscustom/"+d;var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+b)},success:function(e){Notification.show("success","Testimonial deleted successfully");c.loadTestimonial()},error:function(e){if(e.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to delete testimonial")}}})},loadNotification:function(){var d=this;var c=new Array();c.push({name:"q",value:false});var a="/api/testimonials/search/approval";var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,data:c,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+b)},success:function(g){var f=g.page.totalElements,e="";$(".header-notification-title").html("You Have "+f+" New Testimonials");if(f>0){$(".header-notification-badge").html(f);$.map(g._embedded.testimonials,function(j,h){e+='<li class="new"><a onclick="Login.loadModule(\'testimonial\');"><span class="thumb"><img src="/public/images?path='+j.avatarPath+'" alt="" /></span><span class="desc"><span class="name">'+j.name+" ("+j.age+')<span class="badge badge-success">new</span></span><span class="msg">'+j.occupation+"</span></span></a></li>"});e+='<li class="new"><a onclick="Login.loadModule(\'testimonial\');">See All New Testimonials</a></li>';$(".header-notification-list").html(e)}else{$(".header-notification").hide()}},error:function(e){if(e.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load notification")}}})},getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)");var b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))},readImage:function(b,d){if(b.length){var c=b[0];var a=new FileReader();a.onload=function(){data=a.result;d(data)};a.readAsDataURL(c)}else{d()}}}}();