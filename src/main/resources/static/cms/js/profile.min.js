var Profile=function(){return{initialize:function(){var a=this;Login.auth(function(){$(".contentpanel").load("/admin/profile-content-panel",function(){$(".sub-menu-profile").addClass("active");$(".pageheader-h2-icon").attr("class","pageheader-h2-icon");$(".pageheader-h2-icon").addClass("fa fa-wrench");$(".pageheader-h2-text").html(" Profile");$(".pageheader-module").html("Profile");$("#footerDescription").wysihtml5({stylesheets:[]});$("#formvalidate").validate({submitHandler:function(b){a.saveOrUpdate(b)}});$("#btn-cancel").on("click",function(b){b.preventDefault();$("#profileModalForm").modal("hide")});a.loadProfile()})})},loadProfile:function(){if($("#datatable1").length){var d=this;$("#datatable1").dataTable().fnDestroy();$("#datatable1").show();$("#datatable1").dataTable({sAjaxSource:"/api/profiles",sAjaxDataProp:"_embedded.profiles",aoColumns:[{mData:null},{mData:null,mRender:function(g,f,h){var e='<div align="center"><img src="/public/images?path='+h.logo+'" style="padding:3px;border:thin solid #dddddd;border-radius:5px;" /><br>'+h.companyName+"</div>";return e},bSortable:false},{mData:null,mRender:function(g,f,h){var e=h.address1+" <br> "+h.address2;return e},bSortable:false},{mData:"hotline",bSortable:false},{mData:"email",bSortable:false},{mData:null,mRender:function(j,h,l){var f=l.youtubeLink;var i=l.instagramLink;var g=l.facebookLink;var k=l.twitterLink;var e='<i class="fa fa-youtube"></i>'+f+"<br>";e+='<i class="fa fa-instagram"></i>'+i+"<br>";e+='<i class="fa fa-facebook-f"></i>'+g+"<br>";e+='<i class="fa fa-twitter"></i>'+k+"";return e},bSortable:false},{mData:null,mRender:function(g,e,h){var j=h._links.self.href.split("/");var i=j[j.length-1];var f='<a onclick="Profile.detailProfile('+i+')">Edit</a>';f+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Profile.deleteProfile('+i+');}">Delete</a>';return f},bSortable:false}],bServerSide:true,fnServerData:d.serverDataProcessor,fnRowCallback:function(j,h,g,f){var i=h.pageSize;var k=h.pageNum;var e=(k*i+(g+1));$("td:eq(0)",j).html(e);if(h.prime){$(j).css({"background-color":"#ffaabb"})}return j}});var c=$("#datatable1_wrapper");var b=c.find("div[id$=_filter]");var a=' <label><button class="btn btn-sm btn-primary" onclick="Profile.createNewProfile();">Add Profile</button>';b.append(a)}},serverDataProcessor:function(g,o,e){var m={};for(var f=0;f<o.length;f++){m[o[f].name]=o[f].value}var l=m.iDisplayLength;var b=m.iDisplayStart;var k=(b==0)?0:(b/l);var h=m.iSortCol_0;var j=m.sSortDir_0;var n=m["mDataProp_"+h]!=null?m["mDataProp_"+h]:"idProfile";var c=new Array();c.push({name:"size",value:l});c.push({name:"page",value:k});c.push({name:"sort",value:n+","+j});var a=g;if(m.sSearch!=""){a="/api/profiles/search/all";c.push({name:"q",value:m.sSearch})}var d=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,data:c,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer "+d)},success:function(i){i.iTotalRecords=i.page.size;i.iTotalDisplayRecords=i.page.totalElements;$.map(i._embedded.profiles,function(q,p){q.pageNum=k;q.pageSize=l});e(i)},error:function(i){if(i.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load profile")}}})},saveOrUpdate:function(c){var f=this;var e={};$(c).serializeArray().map(function(j){e[j.name]=j.value});var b=e.idProfile;var i=b===""?"POST":"PUT";var a=b===""?"/api/profilescustom":"/api/profilescustom/"+b;var h=$("#logoPath")[0];var g=new Array("image/jpg","image/jpeg","image/png");if(h.files.length&&$.inArray(h.files[0].type,g)===-1){$('label[for="image"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="image"]').css("display","block")}else{var d=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");this.readImage(h.files,function(j){if(typeof j!=="undefined"){e.logo=j.replace(/^data:image\/[a-z]+;base64,/,"");e.logoChanged=true}e=JSON.stringify(e);$.ajax({dataType:"json",contentType:"application/json",type:i,url:a,data:e,beforeSend:function(k){k.setRequestHeader("Authorization","Bearer "+d)},success:function(k){$("#profileModalForm").modal("hide");Notification.show("success","Profile saved successfully",function(){f.loadProfile()})},error:function(k){if(k.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to save profile")}}})})}},createNewProfile:function(){$("#header-title-mode").html("Create New");$("#header-title").html("");$("#idProfile").val("");$("#companyName").val("");$("#address1").val("");$("#address2").val("");$("#hotline").val("");$("#email").val("");$(".logo-preview").css("display","none");$("#logo-image").css("display","none");$("#logo-image").attr("src","");$("#footerDescription").data("wysihtml5").editor.setValue("");$("#footerDescription").autogrow();$("#instagramLink").val("");$("#facebookLink").val("");$("#youtubeLink").val("");$("#twitterLink").val("");$("#prime").attr("checked",false);$("#profileModalForm").modal("show")},detailProfile:function(c){var a="/api/profiles/"+c;var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(d){d.setRequestHeader("Authorization","Bearer "+b)},success:function(d){var f=d._links.self.href.split("/");var e=f[f.length-1];if($.isNumeric(e)){$("#idProfile").val(e)}$("#header-title-mode").html("Edit");$("#header-title").html('"'+d.companyName+'"');$("#companyName").val(d.companyName);$("#address1").val(d.address1);$("#address2").val(d.address2);$("#hotline").val(d.hotline);$("#email").val(d.email);if(d.logo!=null&&d.logo!==""){$(".logo-preview").css("display","block");$("#logo-image").attr("src","/public/images?path="+d.logo);$("#logo-image").css("display","block");$("#logo-image-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview logo-image-preview").html("")}else{$(".logo-preview").css("display","none");$("#logo-image").css("display","none");$("#logo-image").attr("src","")}$("#footerDescription").data("wysihtml5").editor.setValue(d.footerDescription);$("#footerDescription").autogrow();$("#instagramLink").val(d.instagramLink);$("#facebookLink").val(d.facebookLink);$("#youtubeLink").val(d.youtubeLink);$("#twitterLink").val(d.twitterLink);$("#prime").attr("checked",d.prime);$("#profileModalForm").modal("show")},error:function(d){if(d.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load profile")}}})},deleteProfile:function(d){var c=this;var a="/api/profilescustom/"+d;var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+b)},success:function(e){Notification.show("success","Profile deleted successfully");c.loadProfile()},error:function(e){if(e.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to delete profile")}}})},getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)");var b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))},readImage:function(b,d){if(b.length){var c=b[0];var a=new FileReader();a.onload=function(){data=a.result;d(data)};a.readAsDataURL(c)}else{d()}}}}();