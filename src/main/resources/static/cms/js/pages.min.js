var Pages=function(){return{initialize:function(a){var b=this;Login.auth(function(){if(a){$(".contentpanel").load("/admin/addpage-content-panel",function(){$(".sub-menu-pages").addClass("active");$(".pageheader-h2-icon").attr("class","pageheader-h2-icon");$(".pageheader-h2-icon").addClass("fa fa-file-text");$(".pageheader-h2-text").html(" Add Page");$(".pageheader-module").html("Pages");var c=Pages.getUrlParameter("id")===""?"":Pages.getUrlParameter("id");if(c!==""){b.detailPages(c)}$(".chosen-select").chosen({width:"100%"});$("textarea").wysihtml5({stylesheets:[]});$("textarea").autogrow();$("#header-image-image").css("display","none");$(".icon-preview").css("display","none");$("#icon-image").attr("src","");$("#orders").spinner({min:1,max:1000});$("#formvalidate").validate({submitHandler:function(d){Pages.saveOrUpdate(d)}})})}else{$(".contentpanel").load("/admin/pages-content-panel",function(){$(".sub-menu-pages").addClass("active");$(".pageheader-h2-icon").attr("class","pageheader-h2-icon");$(".pageheader-h2-icon").addClass("fa fa-file-text");$(".pageheader-h2-text").html(" Pages");$(".pageheader-module").html("Pages");b.loadPages()})}})},loadPages:function(){if($("#datatable1").length){var a=this;$("#datatable1").dataTable().fnDestroy();$("#datatable1").show();$("#datatable1").dataTable({sAjaxSource:"/api/pages",sAjaxDataProp:"_embedded.pages",aoColumns:[{mData:null},{mData:"title"},{mData:"type"},{mData:"breadcrumb"},{mData:"code"},{mData:"orders"},{mData:null,mRender:function(d,b,e){var g=e._links.self.href.split("/");var f=g[g.length-1];var c='<a href="/admin/addpage?id='+f+'">Edit</a>';c+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Pages.deletePages('+f+');}">Delete</a>';return c},bSortable:false}],bServerSide:true,fnServerData:a.serverDataProcessor,fnRowCallback:function(g,e,d,c){var f=e.pageSize;var h=e.pageNum;var b=(h*f+(d+1));$("td:eq(0)",g).html(b);if(!e.active){$(g).css({"background-color":"#ffaabb"})}return g}})}},serverDataProcessor:function(g,o,e){var m={};for(var f=0;f<o.length;f++){m[o[f].name]=o[f].value}var l=m.iDisplayLength;var b=m.iDisplayStart;var k=(b==0)?0:(b/l);var h=m.iSortCol_0;var j=m.sSortDir_0;var n=m["mDataProp_"+h]!=null?m["mDataProp_"+h]:"idPage";var c=new Array();c.push({name:"size",value:l});c.push({name:"page",value:k});c.push({name:"sort",value:n+","+j});var a=g;if(m.sSearch!=""){a="/api/pages/search/all";c.push({name:"q",value:m.sSearch})}var d=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,data:c,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer "+d)},success:function(i){i.iTotalRecords=i.page.size;i.iTotalDisplayRecords=i.page.totalElements;$.map(i._embedded.pages,function(q,p){q.pageNum=k;q.pageSize=l});e(i)},error:function(i){if(i.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load page")}}})},saveOrUpdate:function(c){var h=this;var f={};$(c).serializeArray().map(function(k){f[k.name]=k.value});var b=f.idPage;var i=b===""?"POST":"PUT";var a=b===""?"/api/pagescustom":"/api/pagescustom/"+b;var d=$("#headerImage")[0],j=$("#icon")[0];var g=new Array("image/jpg","image/jpeg","image/png");if(d.files.length&&$.inArray(d.files[0].type,g)===-1){$('label[for="headerImage"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="headerImage"]').css("display","block")}else{if(j.files.length&&$.inArray(j.files[0].type,g)===-1){$('label[for="icon"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="icon"]').css("display","block")}else{var e=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");this.readImage(d.files,function(k){if(typeof k!=="undefined"){f.headerImagePath=k.replace(/^data:image\/[a-z]+;base64,/,"");f.headerImagePathChanged=true}h.readImage(j.files,function(l){if(typeof l!=="undefined"){f.iconPath=l.replace(/^data:image\/[a-z]+;base64,/,"");f.iconPathChanged=true}f=JSON.stringify(f);$.ajax({dataType:"json",contentType:"application/json",type:i,url:a,data:f,beforeSend:function(m){m.setRequestHeader("Authorization","Bearer "+e)},success:function(m){Notification.show("success","Page saved successfully",function(){window.location.replace("/admin/pages")})},error:function(m){if(m.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to save page")}}})})})}}},detailPages:function(c){var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");var a="/api/pages/"+c;$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(d){d.setRequestHeader("Authorization","Bearer "+b)},success:function(d){var f=d._links.self.href.split("/");var e=f[f.length-1];if($.isNumeric(e)){$("#id-page").val(e)}$("#header-title-mode").html("Edit");$("#header-title").html('"'+d.title+'"');$("#title").val(d.title);$("#type").val(d.type);$("#type").trigger("chosen:updated");$("#breadcrumb").val(d.breadcrumb);$("#content").val(d.content);$("#code").val(d.code);$("#button-text").val(d.buttonText);$("#orders").val(d.orders);if(d.headerImagePath!=null&&d.headerImagePath!==""){$("#header-image-image").attr("src","/public/images?path="+d.headerImagePath);$("#header-image-image").css("display","block");$("#header-image-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview header-image-preview").html("")}else{$("#header-image-image").css("display","none");$("#header-image-image").attr("src","")}if(d.iconPath!=null&&d.iconPath!==""){$("#icon-image").attr("src","/public/images?path="+d.iconPath);$(".icon-preview").css("display","block");$("#icon-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview icon-preview").html("")}else{$(".icon-preview").css("display","none");$("#icon-image").attr("src","")}$("#active").val(d.active?"true":"false");$("#active").trigger("chosen:updated")},error:function(d){if(d.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to load page")}}})},deletePages:function(d){var c=this;var b=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");var a="/api/pagescustom/"+d;$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+b)},success:function(e){Notification.show("success","Page deleted successfully");c.loadPages()},error:function(e){if(e.status==401){Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()})}else{Notification.show("danger","Failed to delete page")}}})},getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)");var b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))},readImage:function(b,d){if(b.length){var c=b[0];var a=new FileReader();a.onload=function(){data=a.result;d(data)};a.readAsDataURL(c)}else{d()}}}}();