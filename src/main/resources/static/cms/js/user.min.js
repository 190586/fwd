var User=function(){return{initialize:function(){var a=this;$(".chosen-select").chosen({width:"100%"});$("#formvalidate").validate({submitHandler:function(b){a.saveOrUpdate(b)}});$("#btn-cancel").on("click",function(b){b.preventDefault();$("#userModalForm").modal("hide")});this.loadUser()},loadUser:function(){var c="/public/images";if($("#datatable1").length){var e=this;$("#datatable1").dataTable().fnDestroy();$("#datatable1").show();$("#datatable1").dataTable({sAjaxSource:"/api/users",sAjaxDataProp:"_embedded.users",aoColumns:[{mData:null},{mData:"username"},{mData:"fullname"},{mData:"role"},{mData:null,mRender:function(h,g,i){var f='<div align="center"><img src="'+c+"?path="+i.avatarPath+'" style="padding:3px;border:thin solid #dddddd;border-radius:5px;"></div>';return f}},{mData:null,mRender:function(h,f,i){var k=i._links.self.href.split("/");var j=k[k.length-1];var g='<a onclick="User.detailUser('+j+')">Edit</a>';g+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {User.deleteUser('+j+');}">Delete</a>';return g},bSortable:false}],bServerSide:true,fnServerData:e.serverDataProcessor,fnRowCallback:function(k,i,h,g){var j=i.pageSize;var l=i.pageNum;var f=(l*j+(h+1));$("td:eq(0)",k).html(f);if(!i.active){$(k).css({"background-color":"#ffaabb"})}return k}});var d=$("#datatable1_wrapper");var b=d.find("div[id$=_filter]");var a=' <label><button class="btn btn-sm btn-primary" onclick="User.createNewUser();">Add User</button>';b.append(a)}},serverDataProcessor:function(f,n,d){var l={};for(var e=0;e<n.length;e++){l[n[e].name]=n[e].value}var k=l.iDisplayLength;var b=l.iDisplayStart;var j=(b==0)?0:(b/k);var g=l.iSortCol_0;var h=l.sSortDir_0;var m=l["mDataProp_"+g]!=null?l["mDataProp_"+g]:"idUser";var c=new Array();c.push({name:"size",value:k});c.push({name:"page",value:j});c.push({name:"sort",value:m+","+h});var a=f;if(l.sSearch!=""){a="/api/users/search/all";c.push({name:"q",value:l.sSearch})}$.ajax({dataType:"json",type:"GET",url:a,data:c,beforeSend:function(i){i.setRequestHeader("Authorization","Bearer token")},success:function(i){i.iTotalRecords=i.page.size;i.iTotalDisplayRecords=i.page.totalElements;$.map(i._embedded.users,function(p,o){p.pageNum=j;p.pageSize=k});d(i)}})},saveOrUpdate:function(e){var h=this;var f={};$(e).serializeArray().map(function(i){f[i.name]=i.value});var g=f.idUser;var d=g===""?"POST":"PUT";var b=g===""?"/api/usercustom":"/api/usercustom/"+g;var a=$("#avatar")[0];var c=new Array("image/jpg","image/jpeg","image/png");if(a.files.length&&$.inArray(a.files[0].type,c)===-1){$('label[for="image"]').html("Accepted formats are only jpg, jpeg and png");$('label[for="image"]').css("display","block")}else{this.readImage(a.files,function(i){if(typeof i!=="undefined"){var j=i.replace(/^data:image\/[a-z]+;base64,/,"");f.avatarPath=j;f.avatarChanged=true}f=JSON.stringify(f);$.ajax({dataType:"json",contentType:"application/json",type:d,url:b,data:f,beforeSend:function(k){k.setRequestHeader("Authorization","Bearer token")},success:function(k){$("#userModalForm").modal("hide");Notification.show("success","User saved successfully",function(){h.loadUser()})},error:function(){Notification.show("danger","Failed to save user")}})})}},createNewUser:function(){$("#header-title-mode").html("Create New");$("#header-title").html("");$("#idUser").val("");$("#username").val("");$("#password").val("");$("#fullname").val("");$("#role").val("");$(".avatar-preview").css("display","none");$("#avatar-image").attr("src","");$("#avatar-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview").html("");Notification.hide();$("#userModalForm").modal("show")},detailUser:function(b){var a="/api/users/"+b;$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(c){c.setRequestHeader("Authorization","Bearer token")},success:function(c){var e=c._links.self.href.split("/");var d=e[e.length-1];if($.isNumeric(d)){$("#idUser").val(d)}$("#header-title-mode").html("Edit");$("#header-title").html('"'+c.username+'"');$("#username").val(c.username);$("#password").val("*******");$("#fullname").val(c.fullname);$("#role").val(c.role);$("#role").trigger("chosen:updated");if(c.avatarPath!=null&&c.avatarPath!==""){$("#avatar-image").attr("src","/public/images?path="+c.avatarPath);$(".avatar-preview").css("display","block");$("#avatar-fileupload").attr("class","fileupload fileupload-new");$(".fileupload-preview").html("")}else{$(".avatar-preview").css("display","none");$("#avatar-image").attr("src","")}$("#active").val(c.active?"true":"false");$("#active").trigger("chosen:updated");Notification.hide();$("#userModalForm").modal("show")},error:function(){Notification.show("danger","Failed to load user")}})},deleteUser:function(c){var b=this;var a="/api/users/"+c;$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:a,beforeSend:function(d){d.setRequestHeader("Authorization","Bearer token")},success:function(d){Notification.show("success","User deleted successfully");b.loadUser()},error:function(){Notification.show("danger","Failed to delete user")}})},getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)");var b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))},readImage:function(b,d){if(b.length){var c=b[0];var a=new FileReader();a.onload=function(){data=a.result;d(data)};a.readAsDataURL(c)}else{d()}}}}();