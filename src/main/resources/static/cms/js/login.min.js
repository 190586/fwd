var Login=function(){return{initialize:function(c){var f=this;if(c){$("#login-warning").hide();$("#loginform").validate({submitHandler:function(g){f.login()}})}else{var e,a,d,b;if(f.checkLS()){e=localStorage.getItem("u");a=localStorage.getItem("f");d=localStorage.getItem("ro");b=localStorage.getItem("ava")}else{e=$.cookie("u");a=$.cookie("f");d=$.cookie("ro");b=$.cookie("ava")}$(".my-role").html(d);$(".my-fullname").html(a);$(".my-avatar-path").attr("src","/public/images?path="+b);$(".sign-out-button").on("click",function(g){g.preventDefault();f.logout()});Testimonial.loadNotification();this.loadModule()}},checkLS:function(){try{localStorage.setItem("test","test");localStorage.removeItem("test");return true}catch(a){return false}},logout:function(){if(this.checkLS()){localStorage.removeItem("t");localStorage.removeItem("r");localStorage.removeItem("f");localStorage.removeItem("ro");localStorage.removeItem("u");localStorage.removeItem("ava")}else{$.removeCookie("t");$.removeCookie("r");$.removeCookie("f");$.removeCookie("ro");$.removeCookie("u");$.removeCookie("ava")}window.location="/login"},auth:function(a){if(this.checkLS()){if(localStorage.getItem("t")&&localStorage.getItem("r")){a();return}}else{if($.cookie("t")&&$.cookie("r")){a();return}}window.location="/login"},login:function(){var e=this;$("#login-warning").hide();$("#login-button").attr("disabled",true);var c="/admin";var d=$("#username").val();var b=$("#password").val();var a="oauth/token?grant_type=password&username="+d+"&password="+b;$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(f){f.setRequestHeader("Authorization","Basic dGFsZW50czpzZWNyZXQ=")},success:function(f){if(f.access_token!=null){if(e.checkLS()){localStorage.setItem("t",f.access_token);localStorage.setItem("r",f.refresh_token)}else{$.cookie("t",f.access_token);$.cookie("r",f.refresh_token)}$.ajax({dataType:"json",type:"GET",url:"api/usercustom/view",beforeSend:function(g){g.setRequestHeader("Authorization","Bearer "+f.access_token)},success:function(g){if(g.ERROR_CODE=="00"){if(e.checkLS()){localStorage.setItem("u",g.RESULTS.username);localStorage.setItem("f",g.RESULTS.fullname);localStorage.setItem("ro",g.RESULTS.role);localStorage.setItem("ava",g.RESULTS.avatarPath)}else{$.cookie("u",g.RESULTS.username);$.cookie("f",g.RESULTS.fullname);$.cookie("ro",g.RESULTS.role);$.cookie("ava",g.RESULTS.avatarPath)}window.location=c}else{$("#login-warning").show();$("#login-button").attr("disabled",false)}},error:function(g){$("#login-warning").show();$("#login-button").attr("disabled",false)}})}},error:function(f){$("#login-warning").show();$("#login-button").attr("disabled",false)}})},loadModule:function(a){$("ul.main-menu li").each(function(b){$(this).removeClass("active")});switch(a){case"pages":Pages.initialize(false);break;case"addpage":Pages.initialize(true);break;case"testimonial":Testimonial.initialize();break;case"menu":Menu.initialize();break;case"profile":Profile.initialize();break;case"myprofile":Profile.initialize();break;case"user":User.initialize();break;default:$(".sub-menu-dashboard").addClass("active");$(".pageheader-h2-icon").attr("class","pageheader-h2-icon");$(".pageheader-h2-icon").addClass("fa fa-home");$(".pageheader-h2-text").html(" Dashboard");$(".pageheader-module").html("Dashboard");$(".contentpanel").html("");break}}}}();